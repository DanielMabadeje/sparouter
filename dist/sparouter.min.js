"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _helpers=require("./helpers");function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},n=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.forEach(function(e){_defineProperty(r,e,t[e])})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}var SPARouter=function(){function o(e){_classCallCheck(this,o),this.routes=[],this.path=this._requestPath(),this._var=_helpers.variableChecker;var r=_objectSpread({},{caseInsensitive:!0,historyMode:!1},e);for(var t in r)this["_".concat(t)]=r[t];return this._checkHistoryMode(),this}return _createClass(o,[{key:"get",value:function(r,e,t){if(!this._var.isSet(r))throw new _helpers.ArgumentNotFoundError("uri");if(!this._var.isSet(e))throw new _helpers.ArgumentNotFoundError("callback");if(!this._var.isString(r))throw new _helpers.ArgumentTypeError("uri","string",r);if(!this._var.isFunction(e))throw new _helpers.ArgumentTypeError("callback","function",e);var n={uri:null,callback:null,thisArg:t=t instanceof o?void 0:t,parameters:null,regExp:null,name:null,current:!1};return this._caseInsensitive&&(r=r.toLowerCase()),r=r.startsWith("/")?r:"/".concat(r),this.routes.forEach(function(e){if(e.uri===r)throw new Error("Conflicting routes. The route uri ".concat(e.uri," already exists"))}),n.uri=r,n.callback=e,n.parameters=this._proccessParameters(n.uri),this.routes.push(n),this}},{key:"where",value:function(t,n){if(!this._var.isSet(t))throw new _helpers.ArgumentNotFoundError("name");if(!this._var.isSet(n))throw new _helpers.ArgumentNotFoundError("regExp");if(!this._var.isString(t))throw new _helpers.ArgumentTypeError("name","string",t);if(!this._var.isString(n))throw new _helpers.ArgumentTypeError("regExp","string",n);var e=this.routes[this.routes.length-1];if(0===e.parameters.length)throw new Error("No Parameters Found: Could not set paramater regExpression for [".concat(e.uri,"] because the route has no parameters"));n=(n=n.replace(/\(/g,"\\(")).replace(/\)/g,"\\)"),n="(".concat(n,"+)");var o=!1;if(e.parameters.forEach(function(e,r){void 0!==e[t]&&(o=!0,e[t].regExp=n)}),!o)throw new Error("Invalid Parameter: Could not set paramater regExpression for [".concat(e.uri,"] because the parameter [").concat(t,"] does not exist"));return this}},{key:"setName",value:function(r){if(!this._var.isSet(r))throw new _helpers.ArgumentNotFoundError("name");if(!this._var.isString(r))throw new _helpers.ArgumentTypeError("name","string",r);var e=this.routes[this.routes.length-1];return this.routes.forEach(function(e){if(e.name===r)throw new Error("Duplicate naming. A route with name ".concat(r," already exists"))}),e.name=r,this}},{key:"init",value:function(){var n=this;this.routes.forEach(function(e){n._proccessRegExp(e)},this);var t=!1,o={pathFor:function(e,r){return n.pathFor(e,r)},goTo:function(e,r,t){return n._goTo(e,r,t)},historyMode:this._historyMode};if(this.routes.some(function(e){if(n._requestPath().match(e.regExp)){e.current=!0,t=!0;var r={};return r.param=n._processRequestParameters(e),r.uri=window.location.pathname,e.callback.call(e.thisArg,r,o)}},this),!t){if(!this._notFoundFunction)return;var e={};return e.uri=window.location.pathname,this._notFoundFunction(e,o)}}},{key:"notFoundHandler",value:function(e){if(!this._var.isSet(e))throw new _helpers.ArgumentNotFoundError("callback");if(!this._var.isFunction(e))throw new _helpers.ArgumentTypeError("callback","function",e);return this._notFoundFunction=e,this}},{key:"redirect",value:function(e,r){return this}},{key:"group",value:function(){}},{key:"_goTo",value:function(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";if(!this._var.isSet(e)||!this._var.isString(e))throw new _helpers.ArgumentTypeError("url","string",e);if(this._var.isEmpty(e))throw new TypeError("url cannot be empty");return this._historyMode?(window.history.pushState(r,t,e),this.init()):(window.localStorage.setItem("pushState",r),window.location.href=e)}},{key:"_pathFor",value:function(h){var l=this,p=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!this._var.isSet(h)||!this._var.isString(h))throw new _helpers.ArgumentTypeError("name","string",string);var f,v=!1;if(this.routes.some(function(e){if(e.name===h&&(v=!0,f=e.uri,l._containsParameter(f))){if(!l._var.isSet(p)||!l._var.isObject(p))throw new _helpers.ArgumentTypeError("parameters","object",p);var r=[],t=!0,n=!1,o=void 0;try{for(var i,a=e.uri.match(/\{(\w+)\}/g)[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;s=(s=s.replace("{","")).replace("}",""),r.push(s)}}catch(e){n=!0,o=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw o}}if(r.length!==Object.getOwnPropertyNames(p).length)throw new Error("The route with name [".concat(h,"] contains ").concat(r.length," parameters. ").concat(Object.getOwnPropertyNames(p).length," given"));for(var u in p){if(!r.includes(u))throw new Error("Invalid parameter name [".concat(u,"]"));var c=new RegExp("{".concat(u,"}"),"g");f=f.replace(c,p[u])}}}),!v)throw new Error("Invalid route name [".concat(h,"]"));return f}},{key:"_proccessParameters",value:function(e){var t=[],n=0;return this._containsParameter(e)&&e.replace(/\{\w+\}/g,function(e){n++,e.replace(/\w+/,function(e){var r={};r[e]={sn:n,regExp:"(\\w+)",value:null},t.push(r)})}),t}},{key:"_proccessRegExp",value:function(e){var n=e.uri;return n=(n=(n=n.replace(/\//g,"\\/")).replace(/\./g,"\\.")).replace("/","/?"),this._containsParameter(e.uri)&&n.replace(/{\w+}/g,function(r){var t=r.replace("{","");return t=t.replace("}",""),e.parameters.some(function(e){if(void 0!==e[t])return n=n.replace(r,e[t].regExp)}),r}),n="^".concat(n,"$"),e.regExp=new RegExp(n),e}},{key:"_containsParameter",value:function(e){return 0<=e.search(/{\w+}/g)}},{key:"_processRequestParameters",value:function(n){var e=this._requestPath().match(n.regExp);if(e){var o={};return e.forEach(function(e,r){if(0!==r){var t=Object.getOwnPropertyNames(n.parameters[r-1]);o[t]=e}}),o}}},{key:"_requestPath",value:function(){return window.location.pathname}},{key:"_checkHistoryMode",value:function(){var r=this;if(this._historyMode&&(window.PopStateEvent||!(!1 in history)))return window.addEventListener("popstate",function(e){r.init()}),this}}]),o}(),_default=SPARouter;exports.default=_default;
//# sourceMappingURL=sparouter.min.js.map
